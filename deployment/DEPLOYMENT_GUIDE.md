# Mall 电商系统部署方案与成本分析

## 方案概述

- **业务规模**: 日订单 < 1万
- **部署方式**: 阿里云/腾讯云 + Docker
- **成本范围**: ¥29/月 ~ ¥330/月

---

## 一、云托管 vs 自建服务对比

| 服务 | 云托管 | 自建 | 差异 |
|------|--------|------|------|
| **MySQL** | ¥400/月 | ¥0 (自己安装) | 托管提供主从复制、自动备份、故障自动切换 |
| **Redis** | ¥150/月 | ¥0 (自己安装) | 托管提供主从、持久化；自建需手动配置 |
| **MongoDB** | ¥400/月 | ¥0 (自己安装) | 托管提供自动备份；自建可以完全一样 |
| **RabbitMQ** | ¥200/月 | ¥0 (自己安装) | 托管提供高可用；自建完全够用 |
| **OSS/COS** | ¥20/月 | 需自己搭建 | **推荐用云存储**，自带CDN加速 |

### 关键差异

**云托管的优势：**
- 免运维：自动备份、监控、故障恢复
- 高可用：主从自动切换
- 弹性扩展：一键升级配置
- 安全：专业安全防护

**自建的优势：**
- 成本低：几乎零成本
- 灵活性高：完全掌控
- 学习价值：深入了解系统

---

## 二、Mall 各模块资源需求分析

| 模块 | 内存占用 | 说明 | 能否省略 |
|------|----------|------|----------|
| **mall-admin** | ~500MB | 后台管理，低并发 | 必需 |
| **mall-portal** | ~800MB | 前台商城，核心业务 | 必需 |
| **mall-search** | ~100MB | 搜索服务 | **可省** |
| **MySQL** | ~1GB | 数据库 | 必需 |
| **Redis** | ~200MB | 缓存 | 必需 |
| **MongoDB** | ~500MB | 浏览历史 | **可省** |
| **RabbitMQ** | ~300MB | 订单超时 | **可省** |
| **Elasticsearch** | ~2GB | 搜索引擎 | **可省** |
| **合计（全开）** | ~5.4GB | | |
| **合计（精简）** | ~2.5GB | | |

---

## 三、服务器配置方案对比

| 配置 | 年成本 | 月均 | 适用场景 | 稳定性 |
|------|--------|------|----------|--------|
| **1核2G** | ¥500-600 | ¥45 | 学习/测试 | ⭐⭐ |
| **1核4G** | ¥900-1200 | ¥85 | 极小流量 | ⭐⭐⭐ |
| **2核4G** | ¥1,500-1,800 | ¥140 | **推荐** | ⭐⭐⭐⭐ |
| 2核8G | ¥2,600-2,940 | ¥220 | 标准生产 | ⭐⭐⭐⭐⭐ |

---

## 四、各云厂商价格对比

### 服务器价格

| 配置 | 阿里云 | 腾讯云 | 华为云 | 新用户优惠 |
|------|--------|--------|--------|------------|
| **1核2G** | ¥600 | ¥500 | ¥500 | **¥99** |
| **1核4G** | ¥1,200 | ¥900 | ¥900 | **¥199** |
| **2核4G** | ¥1,800 | ¥1,500 | ¥1,400 | **¥299** |
| 2核8G | ¥2,940 | ¥2,600 | ¥2,500 | - |

### 新用户优惠活动

**阿里云：**
- 1核2G：¥99/年（3年）
- 1核2G：¥199/年（5年）

**腾讯云：**
- 1核2G：¥95/年（3年）
- 2核4G：¥318/年（3年）

**华为云：**
- 1核2G：¥99/年（3年）
- 2核4G：¥299/年（3年）

---

## 五、完整成本清单

### 1. 必需成本

| 项目 | 用途 | 年成本 | 月均 | 说明 |
|------|------|--------|------|------|
| **ECS/CVM** | 服务器 | ¥2,940 | ¥245 | 2核8G |
| **域名** | 网站访问 | ¥55-300 | ¥5-25 | .com ¥69/年，.cn ¥29/年 |
| **SSL证书** | HTTPS | **¥0** | ¥0 | Let's Encrypt 免费 |
| **弹性IP** | 公网IP | ¥180 | ¥15 | 必需 |
| **合计** | | **¥3,200** | **¥270** | |

### 2. 可选成本

| 项目 | 用途 | 年成本 | 月均 | 替代方案 |
|------|------|--------|------|----------|
| **OSS + CDN** | 图片存储/加速 | ¥600 | ¥50 | 自建 Nginx 存储 |
| **短信服务** | 验证码/通知 | ¥0.05/条 | 按需 | 邮件验证 |
| **备份存储** | 数据备份 | ¥100 | ¥8 | 本地备份 |
| **合计（推荐）** | | **¥700** | **¥58** | |

---

## 六、三种部署方案

### 方案 A：超省钱方案（新用户首年）

```
架构：
├── Nginx
├── mall-admin
├── mall-portal
├── MySQL
└── Redis

移除：
├── mall-search (搜索用 MySQL 实现)
├── MongoDB (浏览历史可不做)
├── RabbitMQ (定时任务替代)
└── Elasticsearch (最占资源)
```

| 项目 | 年成本 | 月均 | 说明 |
|------|--------|------|------|
| ECS (1核2G) | **¥99** | ¥8 | 新用户优惠 |
| 域名 | ¥69 | ¥6 | .com |
| SSL | ¥0 | ¥0 | 免费 |
| 弹性IP | ¥180 | ¥15 | 必需 |
| 存储 | ¥0 | ¥0 | 本地 |
| **合计** | **¥348** | **¥29** | |

**适用场景：**
- 个人学习
- 功能演示
- 日订单 < 50
- 并发 < 10

**JVM 优化配置：**
```bash
# 每个应用只分配 256MB 堆内存
JAVA_OPTS="-Xms256m -Xmx256m -XX:+UseG1GC"
```

**MySQL 优化配置：**
```ini
# my.cnf
innodb_buffer_pool_size = 256M
max_connections = 50
```

---

### 方案 B：性价比方案（推荐）

```
架构：
├── Nginx
├── mall-admin
├── mall-portal
├── MySQL
├── Redis
└── MongoDB (可选)
```

| 项目 | 年成本 | 月均 | 说明 |
|------|--------|------|------|
| ECS (2核4G) | ¥299 | ¥25 | 新用户3年 |
| ECS (2核4G) | ¥1,500 | ¥125 | 续费 |
| 域名 | ¥69 | ¥6 | .com |
| SSL | ¥0 | ¥0 | 免费 |
| 弹性IP | ¥180 | ¥15 | 必需 |
| **首年合计** | **¥548** | **¥46** | |
| **续费合计** | **¥1,749** | **¥146** | |

**适用场景：**
- 小型电商
- 日订单 < 500
- 并发 < 50
- 正式运营

**JVM 配置：**
```bash
# mall-admin: 512MB
JAVA_OPTS="-Xms512m -Xmx512m"

# mall-portal: 768MB
JAVA_OPTS="-Xms768m -Xmx768m"
```

---

### 方案 C：完整生产方案

| 项目 | 年成本 | 月均 | 说明 |
|------|--------|------|------|
| ECS (2核8G) | ¥2,940 | ¥245 | 标准生产 |
| 域名 | ¥69 | ¥6 | .com |
| SSL | ¥0 | ¥0 | 免费 |
| 弹性IP | ¥180 | ¥15 | 必需 |
| OSS + CDN | ¥600 | ¥50 | 图片加速 |
| 短信 | ¥200 | ¥17 | 假设4000条/年 |
| **合计** | **¥3,989** | **¥333** | |

**适用场景：**
- 正式运营
- 日订单 < 5000
- 并发 < 200

---

## 七、部署架构

### 全自建架构（推荐）

```
                    用户
                      │
                      ▼
              ┌─────────────┐
              │   Nginx     │
              │   + SSL     │
              └──────┬──────┘
                     │
        ┌────────────┼────────────┐
        ▼            ▼            ▼
   ┌─────────┐  ┌─────────┐  ┌─────────┐
   │前端静态  │  │应用服务  │  │应用服务  │
   │(本地存储)│  │Docker   │  │Docker   │
   │Nginx    │  │         │  │         │
   └─────────┘  └────┬────┘  └─────────┘
                     │
    ┌────────────────┼────────────────┐
    ▼                ▼                ▼
┌─────────┐    ┌─────────┐      ┌─────────┐
│MySQL    │    │Redis    │      │MongoDB  │
│Docker   │    │Docker   │      │Docker   │
└─────────┘    └─────────┘      └─────────┘
```

**所有服务部署在一台服务器上：**
- Nginx (反向代理 + 静态文件)
- mall-admin (Docker)
- mall-portal (Docker)
- mall-search (可选，Docker)
- MySQL (Docker)
- Redis (Docker)
- MongoDB (可选，Docker)
- RabbitMQ (可选，Docker)

---

## 八、成本优化建议

### 1. 新用户优惠策略

**首年最低成本方案：**
1. 购买新用户优惠服务器（¥99-299/3年）
2. 使用 .com 域名（¥69/年）
3. 使用免费 SSL 证书（Let's Encrypt）
4. 本地存储（¥0）

**首年总成本：¥348-548**

### 2. 续费成本控制

**续费时考虑：**
1. 是否需要升级配置
2. 是否需要添加 CDN
3. 是否需要云存储服务

### 3. 可省略的服务

| 服务 | 功能替代 | 节省成本 |
|------|----------|----------|
| Elasticsearch | MySQL 搜索 | 省去 2GB 内存 |
| MongoDB | 不保存浏览历史 | 省去 500MB 内存 |
| RabbitMQ | 定时任务 | 省去 300MB 内存 |
| OSS + CDN | 本地 Nginx | 省去 ¥600/年 |

---

## 九、部署文件清单

### 脚本文件

| 文件 | 用途 | 路径 |
|------|------|------|
| init-server.sh | 服务器初始化 | document/sh/init-server.sh |
| build.sh | 构建应用 | document/sh/build.sh |
| deploy.sh | 部署应用 | document/sh/deploy.sh |
| backup.sh | 数据备份 | document/sh/backup.sh |

### 配置文件

| 文件 | 用途 | 路径 |
|------|------|------|
| docker-compose-app-prod.yml | 容器编排 | document/docker/docker-compose-app-prod.yml |
| mall.conf | Nginx 配置 | document/nginx/mall.conf |
| .env.example | 环境变量模板 | /opt/mall/config/.env.example |

---

## 十、快速开始

### 1. 购买云服务器

**推荐配置：**
- 阿里云/腾讯云 2核4G
- 新用户优惠 ¥299/3年

### 2. 服务器初始化

```bash
# 上传项目到服务器
scp -r mall root@your-server:/opt/

# 登录服务器
ssh root@your-server

# 初始化服务器
cd /opt/mall/document/sh
sudo ./init-server.sh
```

### 3. 配置环境变量

```bash
# 复制环境变量模板
cp /opt/mall/config/.env.example /opt/mall/config/.env

# 编辑配置
vi /opt/mall/config/.env
```

### 4. 构建部署

```bash
# 构建镜像
./document/sh/build.sh

# 部署应用
./document/sh/deploy.sh
```

### 5. 配置 Nginx

```bash
# 复制 Nginx 配置
cp document/nginx/mall.conf /etc/nginx/conf.d/

# 申请免费 SSL 证书
certbot --nginx -d yourdomain.com

# 重启 Nginx
nginx -s reload
```

---

## 十一、总结

### 成本对比总结

| 方案 | 首年成本 | 续费成本 | 月均 | 适用场景 |
|------|----------|----------|------|----------|
| **超省钱** | ¥348 | ¥750 | ¥29-63 | 学习/测试 |
| **性价比** | ¥548 | ¥1,749 | ¥46-146 | **推荐** |
| **完整生产** | ¥3,989 | ¥3,989 | ¥333 | 正式运营 |

### 推荐方案

**新用户：**
- 首年用 **1核2G ¥99** 试用
- 流量起来后升级到 2核4G

**正式运营：**
- 用 **2核4G** 配置
- 新用户优惠 ¥299/3年
- 续费 ¥1500/年（¥125/月）

**年成本预算：**
- 首年：¥500-600
- 续费：¥1,500-2,000

---

*文档生成时间: 2026-01-14*
