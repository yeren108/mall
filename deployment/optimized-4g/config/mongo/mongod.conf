# =============================================================================
# Mall 电商系统 - MongoDB 4.4 优化配置 (2核4G 服务器)
# 内存分配: 约 300MB
# =============================================================================

# -----------------------------------------------------------------------------
# 存储配置
# -----------------------------------------------------------------------------
storage:
  dbPath: /data/db
  journal:
    enabled: true
    commitIntervalMs: 100

  # WiredTiger 引擎配置
  engine: wiredTiger
  wiredTiger:
    engineConfig:
      # 缓存大小 (300MB)
      cacheSizeGB: 0.3
      # 日志压缩
      journalCompressor: snappy
      # 目录同步配置
      directoryForIndexes: true

    # 集合配置
    collectionConfig:
      # 数据块压缩
      blockCompressor: snappy

    # 索引配置
    indexConfig:
      # 前缀压缩
      prefixCompression: true

# -----------------------------------------------------------------------------
# 系统日志配置
# -----------------------------------------------------------------------------
systemLog:
  destination: file
  path: /var/log/mongodb/mongod.log
  logAppend: true
  logRotate: reopen
  # 日志级别: quiet|verbose|debug
  verbosity: 0
  # 记录慢查询
  slowms: 100
  rateLimit: 100

# -----------------------------------------------------------------------------
# 网络配置
# -----------------------------------------------------------------------------
net:
  port: 27017
  bindIp: 0.0.0.0
  maxIncomingConnections: 100
  wireObjectCheck: true
  ipv6: false

# -----------------------------------------------------------------------------
# 安全配置
# -----------------------------------------------------------------------------
security:
  # 启用认证
  authorization: enabled
  # JavaScript 执行
  javascriptEnabled: true

# -----------------------------------------------------------------------------
# 进程管理
# -----------------------------------------------------------------------------
processManagement:
  fork: false
  # PID 文件
  pidFilePath: /var/run/mongodb/mongod.pid

# -----------------------------------------------------------------------------
# 运行参数
# -----------------------------------------------------------------------------
#setParameter:
  # 连接超时
  # connectionTimeoutMs: 20000
  # 最大并发连接数
  # maxConcurrentTransactions: 100

# -----------------------------------------------------------------------------
# 操作分析
# -----------------------------------------------------------------------------
#operationProfiling:
  # 慢查询阈值 (毫秒)
  # slowOpThresholdMs: 100
  # 模式: off|slowOp|all
  # mode: slowOp

# -----------------------------------------------------------------------------
# 其他优化
# -----------------------------------------------------------------------------
# 禁用透明大页
# echo never > /sys/kernel/mm/transparent_hugepage/enabled
# echo never > /sys/kernel/mm/transparent_hugepage/defrag
